@startuml
' PlantUML component diagram for Food Delivery system
' Place this file in `diagrams/components.puml` and render with PlantUML (server, CLI, or VSCode ext).

skinparam componentStyle rectangle
skinparam shadowing false

package "Clients" {
  [Customer App] <<component>>
  [Admin Panel] <<component>>
  [Restaurant Panel] <<component>>
}

package "Frontend Services" {
  [Nginx (Static)] <<component>>
}

package "Backend (Node.js/Express)" {
  [Express API Server] <<component>>
  [User Controller] <<component>>
  [Food Controller] <<component>>
  [Cart Controller] <<component>>
  [Order Controller] <<component>>
  [Auth Middleware] <<component>>
}

database "Primary DB (MongoDB)" as MongoDB
artifact "Cloudinary (Media)" as Cloudinary
artifact "Stripe (Payment)" as Stripe

note right of Stripe
  No Redis/Queue currently implemented
  Payment handled via Stripe Checkout
  Notifications: Not yet implemented
  Delivery tracking: Basic status only
end note

' Static file serving
[Customer App] --> [Nginx (Static)] : GET / (SPA)
[Admin Panel] --> [Nginx (Static)] : GET / (SPA)
[Restaurant Panel] --> [Nginx (Static)] : GET / (SPA)

' API calls
[Customer App] --> [Express API Server] : REST API (port 4000)
[Admin Panel] --> [Express API Server] : REST API
[Restaurant Panel] --> [Express API Server] : REST API

' Express routes to controllers
[Express API Server] --> [Auth Middleware] : verify JWT token
[Auth Middleware] --> [User Controller] : /api/user (register, login)
[Auth Middleware] --> [Food Controller] : /api/food (list, add, remove)
[Auth Middleware] --> [Cart Controller] : /api/cart (add, remove, get)
[Auth Middleware] --> [Order Controller] : /api/order (place, verify, status)

' Controllers to Database
[User Controller] --> MongoDB : users collection
[Food Controller] --> MongoDB : foods collection
[Cart Controller] --> MongoDB : users.cartData
[Order Controller] --> MongoDB : orders collection

' External integrations
[Food Controller] --> Cloudinary : upload/delete images
[Order Controller] --> Stripe : create checkout session
Stripe --> [Order Controller] : webhook (payment verified)

' User operations
[User Controller] -right-> [Auth Middleware] : create JWT token
[Order Controller] -up-> [User Controller] : clear cart after order

note right of [Order Controller]
  - Creates Stripe checkout session
  - Verifies payment via session ID
  - Updates order status (Food Processing, Out for delivery, Delivered)
  - Cancel order (admin/restaurant only)
  - Confirm delivery (customer)
end note

note left of [User Controller]
  - Register/Login with bcrypt
  - JWT token generation
  - Role-based access (user/admin/restaurant)
  - Uses ADMIN_SETUP_SECRET for admin setup
end note

note right of [Food Controller]
  - CRUD operations for menu items
  - Cloudinary integration for images
  - Admin/Restaurant authorization required for add/remove
end note

' External actors (optional)
actor Customer
actor Admin
actor Restaurant
Customer --> [Customer App]
Admin --> [Admin Panel]
Restaurant --> [Restaurant Panel]

@enduml
