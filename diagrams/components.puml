@startuml
' PlantUML component diagram for Food Delivery system
' Place this file in `diagrams/components.puml` and render with PlantUML (server, CLI, or VSCode ext).

skinparam componentStyle rectangle
skinparam shadowing false

package "Clients" {
  [Customer App] <<component>>
  [Admin Panel] <<component>>
  [Restaurant Panel] <<component>>
}

package "Gateway / Web" {
  [Nginx / Static CDN] <<component>>
  [API Gateway] <<component>>
}

package "Backend Services" {
  [Auth Service] <<component>>
  [User Service] <<component>>
  [Food Service] <<component>>
  [Order Service] <<component>>
  [Payment Service (Stripe)] <<component>>
  [Notification Service] <<component>>
  [Delivery / Driver Service] <<component>>
}

database "Primary DB (MongoDB)" as MongoDB
database "Cache (Redis)" as Redis
artifact "Cloudinary (Media)" as Cloudinary
artifact "Stripe" as Stripe
artifact "Push / Email Provider" as Provider

' Component relationships
[Customer App] --> [Nginx / Static CDN] : fetch SPA
[Admin Panel] --> [Nginx / Static CDN] : fetch SPA
[Restaurant Panel] --> [Nginx / Static CDN] : fetch SPA

[Customer App] --> [API Gateway] : REST / GraphQL
[Admin Panel] --> [API Gateway] : REST
[Restaurant Panel] --> [API Gateway] : REST

[API Gateway] --> [Auth Service] : authenticate / JWT
[API Gateway] --> [User Service] : user CRUD
[API Gateway] --> [Food Service] : list / upload
[API Gateway] --> [Order Service] : create / update / track
[API Gateway] --> [Payment Service (Stripe)] : payment flow
[API Gateway] --> [Notification Service] : notify
[API Gateway] --> [Delivery / Driver Service] : assign / track

' Service to DB / infra
[User Service] --> MongoDB : users collection
[Food Service] --> MongoDB : foods collection
[Order Service] --> MongoDB : orders collection
[Order Service] --> Redis : order locks / short-lived state
[Delivery / Driver Service] --> MongoDB : drivers / locations

' Integrations
[Food Service] --> Cloudinary : upload / delete images
[Payment Service (Stripe)] --> Stripe : charge / webhook
[Notification Service] --> Provider : send email / push

' Internal interactions
[Order Service] --> [Payment Service (Stripe)] : create payment intent
[Payment Service (Stripe)] --> [Order Service] : webhook -> confirm / fail
[Order Service] --> [Notification Service] : order updates
[Order Service] --> [Delivery / Driver Service] : request pickup
[Delivery / Driver Service] --> [Notification Service] : driver updates

' Admin and Restaurant specific interactions
[Admin Panel] --> [Food Service] : create / update / delete food
[Restaurant Panel] --> [Order Service] : accept / prepare orders
[Restaurant Panel] --> [Food Service] : manage menu

note right of [Order Service]
  - persists orders
  - emits events (order.created, order.updated)
  - enforces business rules
end note

note left of [Payment Service (Stripe)]
  - uses `ADMIN_SETUP_SECRET` for admin one-time operations
  - implements Stripe webhooks
end note

' Optional background processing / queue
[Order Service] ..> [Notification Service] : async (queue)
[Order Service] ..> [Delivery / Driver Service] : async (queue)

' External actors (optional)
actor Customer
actor Admin
actor Restaurant
Customer --> [Customer App]
Admin --> [Admin Panel]
Restaurant --> [Restaurant Panel]

@enduml
