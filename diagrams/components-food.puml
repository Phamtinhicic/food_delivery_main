@startuml
' Food Controller - ACTUAL IMPLEMENTATION
skinparam componentStyle rectangle

package "Clients" {
  [Admin Panel] <<component>>
  [Restaurant Panel] <<component>>
  [Customer App] <<component>>
}

package "Backend (Express)" {
  [Food Controller] <<component>>
  [Auth Middleware] <<component>>
  [Multer + Cloudinary] <<component>>
}

database "MongoDB" {
  [foods collection] <<database>>
}

artifact "Cloudinary" as Cloudinary

' Client interactions
[Admin Panel] --> [Auth Middleware] : POST /api/food/add (with image)
[Admin Panel] --> [Auth Middleware] : POST /api/food/remove
[Admin Panel] --> [Auth Middleware] : PUT /api/food/:id/status

[Customer App] --> [Food Controller] : GET /api/food/list (no auth)
[Restaurant Panel] --> [Auth Middleware] : POST /api/food/add
[Restaurant Panel] --> [Auth Middleware] : POST /api/food/remove

' Middleware to Controller
[Auth Middleware] --> [Food Controller] : verify JWT & pass userId

' Food operations
[Food Controller] --> [Multer + Cloudinary] : upload image file
[Multer + Cloudinary] --> Cloudinary : direct upload
Cloudinary --> [Multer + Cloudinary] : return full URL
[Multer + Cloudinary] --> [Food Controller] : req.file.path (URL)

[Food Controller] --> [foods collection] : save food with Cloudinary URL
[Food Controller] --> [foods collection] : find all foods
[Food Controller] --> [foods collection] : delete food by id
[Food Controller] --> [foods collection] : update food availability
[Food Controller] --> Cloudinary : delete image (extract publicId from URL)

note right of [Food Controller]
  **addFood**: Upload image to Cloudinary,
  save food with image URL (admin only)
  
  **listFood**: Get all foods (public)
  
  **removeFood**: Delete from DB and Cloudinary
  (admin only)
  
  **toggleFoodStatus**: Enable/disable food item
  
  Authorization: Checks user.role === "admin"
  in userModel
end note

note left of Cloudinary
  Multer-storage-cloudinary middleware
  handles direct upload
  Returns full URL: 
  https://res.cloudinary.com/.../image.jpg
  
  No queue or background processing
  Upload is synchronous
end note

actor Admin
actor Restaurant
actor Customer
Admin --> [Admin Panel]
Restaurant --> [Restaurant Panel]
Customer --> [Customer App]

@enduml
