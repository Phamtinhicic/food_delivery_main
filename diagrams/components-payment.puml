@startuml
' Payment Flow - ACTUAL IMPLEMENTATION (Stripe Checkout)
skinparam componentStyle rectangle

package "Clients" {
  [Customer App] <<component>>
}

package "Backend (Express)" {
  [Order Controller] <<component>>
}

artifact "Stripe Checkout" as Stripe
database "MongoDB" {
  [orders collection] <<database>>
  [users collection] <<database>>
}

' Payment flow
[Customer App] --> [Order Controller] : POST /api/order/place
[Order Controller] --> Stripe : create checkout session
[Order Controller] --> [users collection] : clear cart
Stripe --> [Customer App] : redirect to Stripe hosted page

[Customer App] --> Stripe : customer enters card info
Stripe --> [Customer App] : redirect to success/cancel URL

[Customer App] --> [Order Controller] : POST /api/order/verify (with session_id)
[Order Controller] --> Stripe : retrieve session
Stripe --> [Order Controller] : payment_status
[Order Controller] --> [orders collection] : create order if paid

note right of [Order Controller]
  **Payment Flow:**
  1. placeOrder: Create Stripe Checkout Session
     - Store order data in session.metadata
     - Get session URL
     - Clear user's cart
  
  2. User pays on Stripe hosted page
  
  3. verifyOrder: Retrieve session by ID
     - Check payment_status === "paid"
     - Create order from metadata
     - Return success
  
  **No webhooks implemented**
  Payment verified via session retrieval
end note

note left of Stripe
  Uses Stripe Checkout (not Payment Intent)
  
  Hosted payment page
  Session stores order metadata
  
  No webhook handler
  No separate payment database
  
  Order created AFTER payment confirmed
end note

actor Customer
Customer --> [Customer App]

@enduml
